
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>安装Metron | Lei&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="zhangleijie">
    

    
    <meta name="description" content="&amp;lt;h3&amp;gt;&amp;lt;a name=&amp;quot;t0&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;1.Metron简介&amp;lt;/h3&amp;gt; Metron是一种多功能的安全遥测数据捕获、流分析和威胁响应平台，最早由Cisco公司的开源大数据系统安全框架项目OpenSOC迁移为Metron项目，现已晋升为Apache顶级项目。Metron提供的功能包括：日志的聚合、对网络包全面捕获的索引和存储、高级">
<meta name="keywords" content="Metron">
<meta property="og:type" content="article">
<meta property="og:title" content="安装Metron">
<meta property="og:url" content="https://github.com/huashishaojie/2019/05/27/安装Metron/index.html">
<meta property="og:site_name" content="Lei&#39;s Blog">
<meta property="og:description" content="&amp;lt;h3&amp;gt;&amp;lt;a name=&amp;quot;t0&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;1.Metron简介&amp;lt;/h3&amp;gt; Metron是一种多功能的安全遥测数据捕获、流分析和威胁响应平台，最早由Cisco公司的开源大数据系统安全框架项目OpenSOC迁移为Metron项目，现已晋升为Apache顶级项目。Metron提供的功能包括：日志的聚合、对网络包全面捕获的索引和存储、高级">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img-blog.csdn.net/20180803152923263?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEyMjA5NjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/de25e22ae0bef09664aa09fea0fbca28.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/08181bd4ab480f4cad6f1c15eec6509d.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/a630d9d505c8abdfd89c3bf9ca5e8ba7.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/aff975d197c31422291a840ae1e88699.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:image" content="https://img-blog.csdn.net/20160222130857077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/fc8afe696331bd77c006d778b5cc9855.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:image" content="http://i2.51cto.com/images/blog/201801/29/7ac6d3d687749ed0aba42cea8827ccf4.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">
<meta property="og:updated_time" content="2019-05-27T11:21:36.935Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="安装Metron">
<meta name="twitter:description" content="&amp;lt;h3&amp;gt;&amp;lt;a name=&amp;quot;t0&amp;quot;&amp;gt;&amp;lt;/a&amp;gt;1.Metron简介&amp;lt;/h3&amp;gt; Metron是一种多功能的安全遥测数据捕获、流分析和威胁响应平台，最早由Cisco公司的开源大数据系统安全框架项目OpenSOC迁移为Metron项目，现已晋升为Apache顶级项目。Metron提供的功能包括：日志的聚合、对网络包全面捕获的索引和存储、高级">
<meta name="twitter:image" content="https://img-blog.csdn.net/20180803152923263?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEyMjA5NjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70">

    
    <link rel="alternative" href="/atom.xml" title="Lei&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Lei&#39;s Blog" title="Lei&#39;s Blog"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Lei&#39;s Blog">Lei&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives/">归档</a></li>
					
						<li><a href="/categories/">分类</a></li>
					
						<li><a href="/tags/">标签</a></li>
					
						<li><a href="/about/">关于</a></li>
					
					<li>
					
						<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
							<label>Search</label>
						<input type="text" class="st-default-search-input" maxlength="20" placeholder="Search">
						</form>
 					
					</li>
				</ul>
			</ul></nav>	
			<script type="text/javascript">
			  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
			  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
			  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
			  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
			  
			  _st('install','quUthZd5kqn79c5URAe7','2.0.0');
			</script>
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/27/安装Metron/" title="安装Metron" itemprop="url">安装Metron</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="zhangleijie" target="_blank" itemprop="author">zhangleijie</a>
		
  </p><p class="article-time">
    <time datetime="2019-05-27T11:19:25.000Z" itemprop="datePublished"> 发表于 2019-05-27</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">2.Metron架构及功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">3.安装Metron</span></a></li></ol>
		
		</div>
		
		<pre><code>&lt;h3&gt;&lt;a name=&quot;t0&quot;&gt;&lt;/a&gt;1.Metron简介&lt;/h3&gt;
</code></pre><p><a href="https://github.com/apache/metron" rel="nofollow" target="_blank">Metron</a>是一种多功能的安全遥测数据捕获、流分析和威胁响应平台，最早由Cisco公司的开源大数据系统安全框架项目OpenSOC迁移为Metron项目，现已晋升为Apache顶级项目。Metron提供的功能包括：日志的聚合、对网络包全面捕获的索引和存储、高级行为分析及数据浓缩，并可以将当前的威胁情报信息应用到安全遥测中。从概念上可划分为四个组件：数据捕获与摄取、实时数据处理、受保证的数据持久化和存储、用于驱动监控和风险报警服务的机器学习模型。</p>

<h3><a name="t1"></a>2.Metron架构及功能</h3>

<p>&nbsp;</p>

<h3><a name="t2"></a>3.安装Metron</h3>

<p>1）基础环境及版本</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp;CentOS 7</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp;Metron 0.4.1</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp;HDP 2.5</p>

<p>Hosts:<br><br>192.168.11.90&nbsp; node1<br><br>192.168.11.103 node2<br><br>192.168.11.104 node3</p>

<p>1)添加epel repository 并更新系统:</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">yum <span class="hljs-keyword">install</span> epel-<span class="hljs-keyword">release</span> -y</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">yum <span class="hljs-keyword">update</span> -y</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>2）配置各节点间的免秘钥登录，具体参考：<a href="https://mp.csdn.net/postedit/81384217" rel="nofollow" target="_blank">https://mp.csdn.net/postedit/81384217</a></p>

<p>3）在将要安装ES和Storm的节点上增加ElasticSearch和Storm的限制（若不确定安装节点，则在所有节点上增加限制）</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby">echo -e <span class="hljs-string">"elasticsearch - memlock unlimited\nstorm - nproc 257597"</span> <span class="hljs-meta">&gt;&gt; </span>/etc/security/limits.conf</code><div class="hljs-button" data-title="复制"></div></pre>

<p>4）调整限制以确保安全级别</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs bash"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">ulimit</span> -n 32768</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">ulimit</span> -u 65536</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">"* - nofile 32768\n* - nproc 65536"</span> &gt;&gt; /etc/security/limits.conf</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>5）禁用IPv6，启用它可能会强制服务仅绑定到IPv6地址，从而导致无法连接到IPv6</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs php"><ol class="hljs-ln" style="width:1013px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sysctl -w net.ipv6.conf.all.disable_ipv6=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sysctl -w net.ipv6.conf.<span class="hljs-keyword">default</span>.disable_ipv6=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">echo</span> -e <span class="hljs-string">"\n# Disable IPv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>6）禁用Transparent Hugepage（Transparent HugePages是RHEL6的新特性）</p>

<p>在kernel配置文件（/etc/ default / grub）的末尾添加“transparent_hugepage = never”，并重新启动(reboot)。</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs python"><ol class="hljs-ln" style="width:928px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># 修改行:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">GRUB_CMDLINE_LINUX=<span class="hljs-string">"crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># 为:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">GRUB_CMDLINE_LINUX=<span class="hljs-string">"crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet transparent_hugepage=never"</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>之后，执行：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs">grub2-mkconfig -o /boot/grub2/grub.cfg</code><div class="hljs-button" data-title="复制"></div></pre>

<p>重启后检查是否已应用更改（确保在方括号中选择“never”字样）</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">cat /sys/kernel/mm/transparent_hugepage/enabled</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">always madvise [never]</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>备注：若不想搞乱内核参数，可以创建一个新的systemd服务，在每次启动时禁用它。方法如下：</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 创建文件“/etc/systemd/system/disable-thp.service”：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs cs"><ol class="hljs-ln" style="width:1167px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-meta">Unit</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Description=<span class="hljs-function"><span class="hljs-function">Disable Transparent Huge <span class="hljs-title">Pages</span> (<span class="hljs-params">THP</span>)</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"> </span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function">[Service]</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function">Type</span>=simple</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">ExecStart=/bin/sh -c <span class="hljs-string">"echo 'never' &gt; /sys/kernel/mm/transparent_hugepage/enabled &amp;&amp; echo 'never' &gt; /sys/kernel/mm/transparent_hugepage/defrag"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-meta">Install</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">WantedBy=multi-user.target</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp;重新启动systemd，启动新服务并确保新服务在启动时运行：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs python"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># systemctl daemon-reload</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># systemctl start disable-thp</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># systemctl enable disable-thp</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>7）禁用SELinux（Ambari和Metron必需条件）：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs java"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">setenforce <span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sed -i <span class="hljs-string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p><strong>Metron安装准备</strong></p>

<p>(1)在所有节点上安装Ambari的先决条件：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql"><ol class="hljs-ln" style="width:1229px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">yum <span class="hljs-keyword">install</span> git wget curl rpm tar unzip scp bzip2 wget createrepo yum-utils ntp python-pip psutils python-psutil ntp libffi-devel gcc openssl-devel -y</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">pip <span class="hljs-keyword">install</span> <span class="hljs-comment">--upgrade pip</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">pip <span class="hljs-keyword">install</span> requests</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>备注：yum 安装 scp 报错：</p>

<p><img alt class="has" src="https://img-blog.csdn.net/20180803152923263?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEyMjA5NjA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p>

<p>原因：yum 不存在独立的scp 包，scp属于openssh-clients这个包。</p>

<p>解决方案：安装openssh-clients 即可</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> openssh-clients</code><div class="hljs-button" data-title="复制"></div></pre>

<p>(2)在Metron节点上安装java 1.8（若不确定Metron安装节点，在所有节点上安装Java1.8）：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs css"><span class="hljs-selector-tag">yum</span> <span class="hljs-selector-tag">install</span> <span class="hljs-selector-tag">java-1</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.0-openjdk</span> <span class="hljs-selector-tag">java-1</span><span class="hljs-selector-class">.8</span><span class="hljs-selector-class">.0-openjdk-devel</span> <span class="hljs-selector-tag">-y</span></code><div class="hljs-button" data-title="复制"></div></pre>

<p>(3)设置Java环境变量：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs javascript"><span class="hljs-keyword">export</span> JAVA_HOME=$(readlink -f /usr/bin/java | sed <span class="hljs-string">"s_/jre/bin/java__"</span>)</code><div class="hljs-button" data-title="复制"></div></pre>

<p>(4)保存java环境变量，以备重启时使用：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs bash"><ol class="hljs-ln" style="width:890px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export JAVA_HOME=$(readlink -f /usr/bin/java | sed "s_/jre/bin/java__")'</span> &gt; /etc/profile.d/java_18.sh</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">chmod +x /etc/profile.d/java_18.sh</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">source</span> /etc/profile.d/java_18.sh</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>(5)下载并安装Maven 3.3.9:</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">wget <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/archive.apache.org/dist</span><span class="hljs-regexp">/maven/maven</span>-<span class="hljs-number">3</span>/<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span>/binaries/apache-maven-<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span>-bin.tar.gz</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">tar -zxf apache-maven-<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span>-bin.tar.gz</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mv apache-maven-<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span> /opt</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">PATH=<span class="hljs-regexp">/opt/apache</span>-maven-<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span>/<span class="hljs-symbol">bin:</span>$PATH</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">echo <span class="hljs-string">'export PATH=/opt/apache-maven-3.3.9/bin:$PATH'</span> &gt; <span class="hljs-regexp">/etc/profile</span>.d/maven.sh</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">chmod +x /etc/profile.d/maven.sh</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>(6)检查Maven是否安装成功：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs bash"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">source</span> /etc/profile.d/maven.sh</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mvn -V</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>若安装成功，执行结果如下：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby"><ol class="hljs-ln" style="width:5424px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># mvn -V</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Apache Maven <span class="hljs-number">3.3</span>.<span class="hljs-number">9</span> (bb52d8502b132ec0a5a3f4c09453c07478323dc5; <span class="hljs-number">2015</span>-<span class="hljs-number">11</span>-<span class="hljs-number">10</span><span class="hljs-symbol">T08:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span><span class="hljs-number">47</span>-08<span class="hljs-symbol">:</span><span class="hljs-number">00</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Maven <span class="hljs-symbol">home:</span> /opt/apache-maven-<span class="hljs-number">3.3</span>.<span class="hljs-number">9</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Java <span class="hljs-symbol">version:</span> <span class="hljs-number">1.8</span>.<span class="hljs-number">0_131</span>, <span class="hljs-symbol">vendor:</span> Oracle Corporation</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Java <span class="hljs-symbol">home:</span> /usr/lib/jvm/java-<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>-openjdk-<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>.<span class="hljs-number">131</span>-<span class="hljs-number">3</span>.b12.el7_3.x86_64/jre</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Default <span class="hljs-symbol">locale:</span> en_US, platform <span class="hljs-symbol">encoding:</span> UTF-<span class="hljs-number">8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">OS <span class="hljs-symbol">name:</span> <span class="hljs-string">"linux"</span>, <span class="hljs-symbol">version:</span> <span class="hljs-string">"3.10.0-514.16.1.el7.x86_64"</span>, <span class="hljs-symbol">arch:</span> <span class="hljs-string">"amd64"</span>, <span class="hljs-symbol">family:</span> <span class="hljs-string">"unix"</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] Scanning <span class="hljs-keyword">for</span> projects...</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] ------------------------------------------------------------------------</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] BUILD FAILURE</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] ------------------------------------------------------------------------</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] Total <span class="hljs-symbol">time:</span> <span class="hljs-number">0</span>.083 s</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] Finished <span class="hljs-symbol">at:</span> <span class="hljs-number">2017</span>-<span class="hljs-number">06</span>-<span class="hljs-number">06</span><span class="hljs-symbol">T09:</span><span class="hljs-number">59</span><span class="hljs-symbol">:</span><span class="hljs-number">03</span>-<span class="hljs-number">07</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] Final <span class="hljs-symbol">Memory:</span> <span class="hljs-number">13</span>M/<span class="hljs-number">479</span>M</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[INFO] ------------------------------------------------------------------------</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR] No goals have been specified <span class="hljs-keyword">for</span> this build. You must specify a valid lifecycle phase <span class="hljs-keyword">or</span> a goal <span class="hljs-keyword">in</span> the format &lt;plugin-prefix&gt;<span class="hljs-symbol">:&lt;goal&gt;</span> <span class="hljs-keyword">or</span> &lt;plugin-group-id&gt;<span class="hljs-symbol">:&lt;plugin-artifact-id&gt;</span>[<span class="hljs-symbol">:&lt;plugin-version&gt;</span>]<span class="hljs-symbol">:&lt;goal&gt;</span>. Available lifecycle phases <span class="hljs-symbol">are:</span> validate, initialize, generate-sources, process-sources, generate-resources, process-resources, compile, process-classes, generate-test-sources, process-test-sources, generate-test-resources, process-test-resources, test-compile, process-test-classes, test, prepare-package, package, pre-integration-test, integration-test, post-integration-test, verify, install, deploy, pre-clean, clean, post-clean, pre-site, site, post-site, site-deploy. -&gt; [Help <span class="hljs-number">1</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR] Re-run Maven using the -X switch to enable full debug logging.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR] For more information about the errors <span class="hljs-keyword">and</span> possible solutions, please read the following <span class="hljs-symbol">articles:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ERROR] [Help <span class="hljs-number">1</span>] <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/cwiki.apache.org/confluence</span><span class="hljs-regexp">/display/</span>MAVEN/NoGoalSpecifiedException</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>(7) 在Ambari节点上安装并启用docker(需要使用docker为Ambari创建Metron包)</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">yum <span class="hljs-keyword">install</span> docker-io -y</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">start</span> docker</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>(8)在打包节点上安装nmp，这是构建metron-config所必需的，它是UI的一部分。</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> npm -y</code><div class="hljs-button" data-title="复制"></div></pre>

<p>(9)在 /etc/hosts文件中添加：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="language-bash hljs">127.0.0.1 localhost</code><div class="hljs-button" data-title="复制"></div></pre>

<p>(10)在主节点上安装数据库，以备Metron REST使用：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> mariadb-<span class="hljs-keyword">server</span> -y</code><div class="hljs-button" data-title="复制"></div></pre>

<p>(11)&nbsp;在所有节点上安装JAVA MySQL连接器：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> mysql-connector-<span class="hljs-keyword">java</span> -y</code><div class="hljs-button" data-title="复制"></div></pre>

<p><strong>配置Metron REST数据库</strong></p>

<p>安装数据库后运行”mysql_secure_installation”进行初始安全设置：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">start</span> mariadb</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">enable</span> mariadb</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">status</span> mariadb</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql_secure_installation # </div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p id="Metron0.4.1withHDP2.5bare-metalinstallonCentos7withMariaDBforMetronREST-BuildMetroncode"><strong>打包 Metron code</strong></p>

<p>1)从github上克隆Metron repo并切换到0.4.1版本：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs php"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/apache/metron</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">cd metron</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">git checkout Metron_0<span class="hljs-number">.4</span><span class="hljs-number">.1</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>2)使用HDP 2.5构建Metron：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs bash"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">cd</span> metron</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mvn clean package -DskipTests -T 2C -P HDP-2.5.0.0,mpack</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-built_in">cd</span> metron-deployment/packaging/docker/rpm-docker</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mvn clean install -DskipTests -PHDP-2.5.0.0</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp;备注：如果rpm-docker失败并报错如下：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs">/bin/bash：./build.sh：Permission denied</code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp;请禁用selinux后重试&nbsp;</p>

<p>3)在所有节点上，创建localrepo目录并从Ambari节点复制RPM：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs perl"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">mkdir</span> /localrepo</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">cp -rp /root/metron/metron-deployment/packaging/docker/rpm-docker/RPMS/noarch/* <span class="hljs-regexp">/localrepo/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">createrepo /localrepo</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; &nbsp;备注：如果多节点安装，还要将软件包复制到其他节点：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">ssh root@node2 mkdir /localrepo</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">scp /localrepo/*rpm root@node2<span class="hljs-symbol">:/localrepo/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">ssh root@node2 createrepo /localrepo</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>4) 为Hadoop服务获取并创建logrotate脚本：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs java"><ol class="hljs-ln" style="width:1375px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">wget -O /etc/logrotate.d/metron-ambari https:<span class="hljs-comment">//raw.githubusercontent.com/apache/metron/master/metron-deployment/roles/ambari_common/templates/metron-hadoop-logrotate.yml</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sed -i <span class="hljs-string">'s/^  .*$/  daily/'</span> /etc/logrotate.d/metron-ambari</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sed -i <span class="hljs-string">'s/^  rotate .*$/  rotate 30/'</span> /etc/logrotate.d/metron-ambari</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">chmod <span class="hljs-number">0644</span> /etc/logrotate.d/metron-ambari</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p><strong>安装Ambari</strong></p>

<p>（1）首先，在每个节点上时间同步，禁用防火墙和SElinux</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl enable ntpd</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">start</span> ntpd</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -P <span class="hljs-keyword">INPUT</span> <span class="hljs-keyword">ACCEPT</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -P FORWARD <span class="hljs-keyword">ACCEPT</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -P <span class="hljs-keyword">OUTPUT</span> <span class="hljs-keyword">ACCEPT</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -t nat -F</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -t mangle -F</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -F</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables -X</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">iptables-<span class="hljs-keyword">save</span> &gt; /etc/sysconfig/iptables</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">stop</span> firewalld</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">systemctl <span class="hljs-keyword">disable</span> firewalld</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">setenforce <span class="hljs-number">0</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>备注：如果使用的是CentOS 7和Python 2.7.5及更高版本，则在Ambari UI中安装ambari代理时会遇到错误：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs css"><span class="hljs-selector-attr">[SSL: CERTIFICATE_VERIFY_FAILED]</span> <span class="hljs-selector-tag">certificate</span> <span class="hljs-selector-tag">verify</span> <span class="hljs-selector-tag">failed</span> (_<span class="hljs-selector-tag">ssl</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-pseudo">:579)</span></code><div class="hljs-button" data-title="复制"></div></pre>

<p>解决办法：要修复它，请在Python中禁用cert检查</p>

<p>参考：<a href="https://community.hortonworks.com/questions/120861/ambari-agent-ssl-certificate-verify-failed-certifi.html" rel="nofollow" target="_blank">https://community.hortonworks.com/questions/120861/ambari-agent-ssl-certificate-verify-failed-certifi.html</a></p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs java">sed -i <span class="hljs-string">'s/verify=platform_default/verify=disable/'</span> /etc/python/cert-verification.cfg</code><div class="hljs-button" data-title="复制"></div></pre>

<p>（2）确保每个节点都可以解析每个其他节点的主机名，即将每个节点的主机名添加到/etc/hosts</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs css"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">10<span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.1</span> <span class="hljs-selector-tag">node1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">10<span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.2</span> <span class="hljs-selector-tag">node2</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">10<span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.3</span> <span class="hljs-selector-tag">node3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">10<span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.10</span><span class="hljs-selector-class">.4</span> <span class="hljs-selector-tag">node4</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>（3）在主节点下载和设置Ambari repo（可以用更新的Ambari版本号替换”2.4.3.0”）</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby">wget -nv <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/public-repo-1.hortonworks.com/ambari</span><span class="hljs-regexp">/centos7/</span><span class="hljs-number">2</span>.x/updates/<span class="hljs-number">2.4</span>.<span class="hljs-number">3.0</span>/ambari.repo -O /etc/yum.repos.d/ambari.repo</code><div class="hljs-button" data-title="复制"></div></pre>

<p>（4）检查是否添加成功：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs perl"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">yum repolist | <span class="hljs-keyword">grep</span> ambari</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># Updates-ambari-2.4.3.0   ambari-2.4.3.0 - Updates </span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>（5）制作本地yum源：</p>

<p>&nbsp; &nbsp; a、首先下载包含必要软件的压缩包（tarball）到本地，以CentOS7，Ambari 2.4.3和HDP 2.5.0.0为例：</p>

<p>Ambari-2.4.3.0 压缩包地址：</p>

<p><a href="http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.4.3.0/ambari-2.4.3.0-centos7.tar.gz" rel="nofollow" target="_blank">http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.4.3.0/ambari-2.4.3.0-centos7.tar.gz</a></p>

<p>HDP-2.5.0.0压缩包地址：</p>

<p><a href="http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.5.0.0/HDP-2.5.0.0-centos7-rpm.tar.gz" rel="nofollow" target="_blank">http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.5.0.0/HDP-2.5.0.0-centos7-rpm.tar.gz</a></p>

<p>HDP UTILS压缩包下载地址：</p>

<p><a href="http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.21/repos/centos7/HDP-UTILS-1.1.0.21-centos7.tar.gz" rel="nofollow" target="_blank">http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.21/repos/centos7/HDP-UTILS-1.1.0.21-centos7.tar.gz</a></p>

<p>其他版本，下载地址请参考：</p>

<p>Ambari：</p>

<p><a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.1.0/bk_ambari-installation/content/ambari_repositories.html" rel="nofollow" target="_blank">http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.1.0/bk_ambari-installation/content/ambari_repositories.html</a></p>

<p>HDP和HDP UTILS：</p>

<p><a href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.1.0/bk_ambari-installation/content/hdp_stack_repositories.html" rel="nofollow" target="_blank">http://docs.hortonworks.com/HDPDocuments/Ambari-2.4.1.0/bk_ambari-installation/content/hdp_stack_repositories.html</a></p>

<p>b、设置本地库，我们先需要完成一些准备工作，如下：</p>

<p><ol><li>选择一台机器作为本地库的镜像服务器，这个机器能够被集群中的机器所访问，且有一个被支持的操作系统。</li><br>    <li>此台镜像服务器有软件包管理，例如centOS的yum。</li><br></ol></p><p>c、在镜像服务器上安装一个HTTP服务（例如Apache httpd）</p><p></p>
<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> httpd</code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp;启动web 服务：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs perl"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[root@master ~]<span class="hljs-comment"># systemctl start httpd</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[root@master ~]<span class="hljs-comment"># systemctl enable httpd</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;d、把下载到的3个资源文件，并解压到http服务（web服务）目录下：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs python"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># mkdir /var/www/html/ambari-hdp</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># mkdir /var/www/html/ambari-hdp/HDP-UTILS</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># tar -xvf ambari-2.4.1.0-centos7.tar.gz -C /var/www/html/ambari-hdp/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># tar -xvf HDP-2.5.0.0-centos7-rpm.tar.gz -C /var/www/html/ambari-hdp/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># tar -xvf HDP-UTILS-1.1.0.21-centos7.tar.gz -C /var/www/html/ambari-hdp/HDP-UTILS</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>e、&nbsp;确认解压目录正常，在浏览器中确认是否可以访问，访问地址如下：</p>

<p>Ambari Base URL：<a href="http://172.16.16.183:82/ambari-hdp/centos7/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/centos7/</a></p>

<p>HDP Base URL：<a href="http://172.16.16.183:82/ambari-hdp/HDP/centos7/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/HDP/centos7/</a></p>

<p>HDP-UTILS Base URL：<a href="http://172.16.16.183:82/ambari-hdp/HDP-UTILS/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/HDP-UTILS/</a></p>

<p id="3配置yum本地源">f、配置Yum本地Repos资源池（在每台node上）</p>

<p>安装插件：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> yum-<span class="hljs-keyword">plugin</span>-priorities</code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;编辑<code>/etc/yum/pluginconf.d/priorities.conf</code>&nbsp;文件添加如下配置:</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs cs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-meta">main</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">enabled=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgcheck=<span class="hljs-number">0</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p id="32-制作本地资源文件">制作本地资源文件，创建Ambari、HDP、HDP-UTIL资源文件：</p>

<p><ul><li>&nbsp; ambari.repo</li><br></ul><pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln" style="width:875px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[ambari-<span class="hljs-number">2.4</span>.<span class="hljs-number">1.0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">name</span>=ambari-<span class="hljs-number">2.4</span>.<span class="hljs-number">1.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">baseurl=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/AMBARI-2.4.1.0/centos7/2.4.1.0-22/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgcheck=<span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgkey=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/AMBARI-2.4.1.0/centos7/2.4.1.0-22/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">enabled=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">priority=<span class="hljs-number">1</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre></p>
<p><ul><li>&nbsp; hdp.repo</li><br></ul><pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[HDP-<span class="hljs-number">2.5</span>.<span class="hljs-number">0.0</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">name</span>=Hortonworks Data <span class="hljs-keyword">Platform</span> Version - HDP-<span class="hljs-number">2.5</span>.<span class="hljs-number">0.0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">baseurl=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/HDP/centos7</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgcheck=<span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgkey=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/HDP/centos7/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">enabled=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">priority=<span class="hljs-number">1</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre></p>
<p><ul><li>&nbsp;&nbsp;hdp-util.repo</li><br></ul><pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[HDP-UTILS-<span class="hljs-number">1.1</span>.<span class="hljs-number">0.21</span>]</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">name</span>=Hortonworks Data <span class="hljs-keyword">Platform</span> Version - HDP-UTILS-<span class="hljs-number">1.1</span>.<span class="hljs-number">0.21</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">baseurl=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/HDP-UTILS/</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgcheck=<span class="hljs-number">0</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">gpgkey=http:<span class="hljs-comment">//192.168.0.203/ambari-hdp/HDP-UTILS/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">enabled=<span class="hljs-number">1</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">priority=<span class="hljs-number">1</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre></p>
<p>&nbsp; &nbsp;查看资源池：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs css"><ol class="hljs-ln" style="width:1113px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-attr">[root@master yum.repos.d]</span># <span class="hljs-selector-tag">yum</span> <span class="hljs-selector-tag">repolist</span> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-tag">repo</span> <span class="hljs-selector-tag">id</span>                                          <span class="hljs-selector-tag">repo</span> <span class="hljs-selector-tag">name</span>                                                                     <span class="hljs-selector-tag">status</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-tag">HDP-2</span><span class="hljs-selector-class">.5</span>                                          <span class="hljs-selector-tag">HDP-2</span><span class="hljs-selector-class">.5</span>                                                                        0+200</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-tag">HDP-2</span><span class="hljs-selector-class">.5</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>                                      <span class="hljs-selector-tag">Hortonworks</span> <span class="hljs-selector-tag">Data</span> <span class="hljs-selector-tag">Platform</span> <span class="hljs-selector-tag">Version</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">HDP-2</span><span class="hljs-selector-class">.5</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>                                  200</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-tag">HDP-UTILS-1</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.21</span>                               <span class="hljs-selector-tag">HDP-UTILS-1</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.21</span>                                                                64</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">  <span class="hljs-selector-tag">ambari-2</span><span class="hljs-selector-class">.4</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.0</span>                                   <span class="hljs-selector-tag">ambari-2</span><span class="hljs-selector-class">.4</span><span class="hljs-selector-class">.1</span><span class="hljs-selector-class">.0</span>   </div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>（5）安装和设置Ambari server：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs sql">yum <span class="hljs-keyword">install</span> ambari-<span class="hljs-keyword">server</span> -y</code><div class="hljs-button" data-title="复制"></div></pre>

<p>安装完成后创建ambari数据库及用户，登录root用户执行下面语句：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; create database ambari character <span class="hljs-keyword">set</span> utf8;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; CREATE USER <span class="hljs-string">'ambari'</span>@<span class="hljs-string">'%'</span> IDENTIFIED BY <span class="hljs-string">'ambari'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; GRANT ALL PRIVILEGES <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'ambari'</span>@<span class="hljs-string">'%'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; FLUSH PRIVILEGES;</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>如果要安装Hive，再创建Hive数据库和用户 再执行下面的语句：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; create database hive character <span class="hljs-keyword">set</span> utf8;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; CREATE USER <span class="hljs-string">'hive'</span>@<span class="hljs-string">'%'</span> IDENTIFIED BY <span class="hljs-string">'hive'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; GRANT ALL PRIVILEGES <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'hive'</span>@<span class="hljs-string">'%'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; FLUSH PRIVILEGES;</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>如果要安装Oozie，再创建Oozie数据库和用户 再执行下面的语句：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; create database oozie character <span class="hljs-keyword">set</span> utf8;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; CREATE USER <span class="hljs-string">'oozie'</span>@<span class="hljs-string">'%'</span> IDENTIFIED BY <span class="hljs-string">'oozie'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; GRANT ALL PRIVILEGES <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'oozie'</span>@<span class="hljs-string">'%'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; FLUSH PRIVILEGES; </div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>（6） 配置Ambari-Server</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs perl"><ol class="hljs-ln" style="width:1590px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[root@node-<span class="hljs-number">1</span> ~]<span class="hljs-comment"># ambari-server setup</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Using python  /usr/bin/python</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Setup ambari-server</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Checking SELinux...</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">SELinux status is <span class="hljs-string">'disabled'</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Customize user account <span class="hljs-keyword">for</span> ambari-server daemon [<span class="hljs-regexp"><span class="hljs-regexp">y/n] (n)? y</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Enter user account for ambari-server daemon (root):ambari  </span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Adjusting ambari-server permissions and ownership...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Checking firewall status...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Checking JDK...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[3] Custom JDK</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">==============================================================================</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Enter choice (1): 3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Path to JAVA_HOME: /usr/lib</span><span class="hljs-regexp">/jvm/java</span>-<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>-openjdk-<span class="hljs-number">1.8</span>.<span class="hljs-number">0</span>.<span class="hljs-number">161</span>-<span class="hljs-number">0</span>.b14.el7_4.x86_64/jre  <span class="hljs-comment"># 填写java_home</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Validating JDK on Ambari Server...done.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Checking GPL software agreement...</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">GPL License <span class="hljs-keyword">for</span> LZO: https:<span class="hljs-regexp">//www</span>.gnu.org/licenses/old-licenses/gpl-<span class="hljs-number">2.0</span>.en.html</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Enable Ambari Server to download <span class="hljs-keyword">and</span> install GPL Licensed LZO packages [<span class="hljs-regexp"><span class="hljs-regexp">y/n] (n)? n</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Completing setup...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Configuring database...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Enter advanced database configuration [y/n] (n)? y  </span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Configuring database...</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">==============================================================================</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">Choose one of the following options:</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[1] - PostgreSQL (Embedded)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[2] - Oracle</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-regexp">[3] - MySQL /</span> MariaDB</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-number">4</span>] - PostgreSQL</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-number">5</span>] - Microsoft SQL Server (Tech Preview)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-number">6</span>] - SQL Anywhere</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-number">7</span>] - BDB</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">==============================================================================</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Enter choice (<span class="hljs-number">1</span>): <span class="hljs-number">3</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Hostname (localhost): </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Port (<span class="hljs-number">3306</span>): </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Database name (ambari): </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Username (ambari): </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="42"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Enter Database Password (bigdata): </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="43"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Configuring ambari database...</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="44"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">WARNING: Before starting Ambari Server, you must copy the MySQL JDBC driver JAR file to /usr/share/java <span class="hljs-keyword">and</span> set property <span class="hljs-string">"server.jdbc.driver.path=[path/to/custom_jdbc_driver]"</span> in ambari.properties.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="45"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Press &lt;enter&gt; to continue.</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;到上面一步时，提示需要配置mysql的 jdbc驱动，并修改Ambari配置文件，指定jdbc驱动文件位置：</p>

<p>在安装Metron准备(11)步骤时我们安装了JAVA MySQL连接器其默认路径为（/usr/share/java/）,所以我们只需要在Ambari配置文件中添加jdbc驱动文件位置即可，即在编辑/etc/ambari-server/conf/ambari.properties添加如下配置：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby">server.jdbc.driver.path=<span class="hljs-regexp">/usr/share</span><span class="hljs-regexp">/java/mysql</span>-connector-java.jar</code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;配置完成后继续，会出现如下提示：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs vbscript"><ol class="hljs-ln" style="width:1413px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Press &lt;enter&gt; <span class="hljs-keyword">to</span> continue.</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Configuring remote database connection properties...</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">WARNING: Before starting Ambari <span class="hljs-built_in">Server</span>, you must run the following DDL against the database <span class="hljs-keyword">to</span> create the schema: /var/lib/ambari-<span class="hljs-built_in">server</span>/resources/Ambari-DDL-MySQL-CREATE.sql</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Proceed <span class="hljs-keyword">with</span> configuring remote database connection properties [y/n] (y)? </div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;出现上述提示时，根据信息导入数据库：将Ambari数据库脚本导入到数据库。Ambari安装会将安装等信息写入数据库，建议使用自己安装的MySQL数据库，也可以不安装而使用默认数据库PostgreSQL。如果使用自己定义的数据库，必须在启动Ambari服务之前导入Ambari的sql脚本。</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs php"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment"># mysql -uroot -p</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; <span class="hljs-keyword">use</span> <span class="hljs-title">ambari</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">mysql&gt; source /<span class="hljs-keyword">var</span>/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql;</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>（6）通过运行mpack命令将Metron服务添加到Ambari（确保在–mpack =中指定正确的mpack路径）：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs ruby">ambari-server install-mpack --mpack=<span class="hljs-regexp">/root/metron</span><span class="hljs-regexp">/metron-deployment/packaging</span><span class="hljs-regexp">/ambari/metron</span>-mpack/target/metron_mpack-<span class="hljs-number">0</span>.<span class="hljs-number">4.1</span>.<span class="hljs-number">0</span>.tar.gz --verbose</code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp;（7）启动Ambari服务</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs vbscript">ambari-<span class="hljs-built_in">server</span> start</code><div class="hljs-button" data-title="复制"></div></pre>

<p>（8）服务启动成功后，会监听8080端口，通过在Web浏览器中访问Ambari UI：http://&lt;Ambari_server_ip&gt;:8080/，账号密码admin/admin正常登录，则安装完成。结果如下图所示（图片来自网络，仅供参考）：</p>

<p><img alt class="has" src="http://i2.51cto.com/images/blog/201801/29/de25e22ae0bef09664aa09fea0fbca28.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="></p>

<p>（9）创建集群</p>

<p>使用ambari的web界面可完成对集群的所有管理操作，创建一个实例集群。</p>

<p><img alt class="has" src="http://i2.51cto.com/images/blog/201801/29/08181bd4ab480f4cad6f1c15eec6509d.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="></p>

<p>&nbsp;选择本地源，移除不必要的版本：</p>

<p><img alt class="has" src="http://i2.51cto.com/images/blog/201801/29/a630d9d505c8abdfd89c3bf9ca5e8ba7.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="></p>

<p>&nbsp;设置本地源为以上步骤中制作的本地源：</p>

<p>Base URL：ambari ：<a href="http://172.16.16.183:82/ambari-hdp/ambari/centos7/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/ambari/centos7/</a></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HDP ：<a href="http://172.16.16.183:82/ambari-hdp/HDP/centos7/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/HDP/centos7/</a></p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HDP-UTILS：<a href="http://172.16.16.183:82/ambari-hdp/HDP-UTILS/" rel="nofollow" target="_blank">http://172.16.16.183:82/ambari-hdp/HDP-UTILS/</a></p>

<p>及Metron 源采用本地源：file:////localrepo/repodata</p>

<p>添加主机节点，上传（Ambari server 节点的）id_rsa文件：<br><img alt="使用Ambari搭建Hadoop集群" class="has" src="http://i2.51cto.com/images/blog/201801/29/aff975d197c31422291a840ae1e88699.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="></p>

<p>（9）安装Ambari agent，组建集群，如下图所示（由于在安装过程中不仅需要从本地HDP及Metron配置的源中下载文件还需要联网下载文件所以需要时间较长，且有时会因为网络超时导致安装失败，可能需要多次重试，请周知）：</p>

<p><img alt class="has" src="https://img-blog.csdn.net/20160222130857077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></p>

<p>&nbsp;在安装过程中，ambari注册主机的时候，ambari-agent出现如下错误：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs css"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-selector-tag">NetUtil</span><span class="hljs-selector-class">.py</span><span class="hljs-selector-pseudo">:96</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">EOF</span> <span class="hljs-selector-tag">occurred</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">violation</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">protocol</span> (_<span class="hljs-selector-tag">ssl</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-pseudo">:579)</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-selector-tag">NetUtil</span><span class="hljs-selector-class">.py</span><span class="hljs-selector-pseudo">:97</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">SSLError</span>: <span class="hljs-selector-tag">Failed</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">connect</span>. <span class="hljs-selector-tag">Please</span> <span class="hljs-selector-tag">check</span> <span class="hljs-selector-tag">openssl</span> <span class="hljs-selector-tag">library</span> <span class="hljs-selector-tag">versions</span>.</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>有两种可能：</p>

<p>第一是有可能如前面所提到的使用的是centos7、python 2.7.5及以上版本的python 会在安装Ambari agent时报错：</p>

<p><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><br>            <p><code>[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (<a href="https://cwiki.apache.org/confluence/display/METRON/_ssl.c:" rel="nofollow" target="_blank">_ssl.c:</a></code><code>579</code><code>)</code></p><br>            </td><br>        </tr></tbody></table></p><p>解决办法是：要解决此问题，即在此处禁用Python中的证书检查</p><p></p>
<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs java"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">sed -i <span class="hljs-string">'s/verify=platform_default/verify=disable/'</span> /etc/python/cert-verification.cfg</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>第二是Ambari agent安全验证引起的；</p>

<p>解决方案 在ambari-agent的配置文件ambari-agent.ini 在 ［security］增加一项</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs cs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">[<span class="hljs-meta">security</span>] </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">force_https_protocol=PROTOCOL_TLSv1_2</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>2.如出现bootstrap、stack-recommendations 目录找不到的错误：</p>

<p>解决方案：</p>

<p>进入/var/run/ambari-server,手动创建bootstrap文件夹，并对其添加owner为ambari：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs perl"><span class="hljs-keyword">chown</span> ambari bootstrap</code><div class="hljs-button" data-title="复制"></div></pre>

<p>然后重启Ambari server</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs vbscript">ambari-<span class="hljs-built_in">server</span> restart</code><div class="hljs-button" data-title="复制"></div></pre>

<p>安装成功后，会显示如下界面：<br><img alt="使用Ambari搭建Hadoop集群" class="has" src="http://i2.51cto.com/images/blog/201801/29/fc8afe696331bd77c006d778b5cc9855.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="><br><br>（9）使用Ambari安装其他组件</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; a.首先，输入集群任意集群名称；</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp; b.选择版本：确保选中”Public Repository”。您还应该看到列出的/localrepo目录。</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp;c.设置安装选项：在”Target Hosts”中指定安装Ambari集群的节点的主机名（/ etc / hosts中指定的所有节点）。在”Host Registration Information”中复制主节点私钥（/root/.ssh/id_rsa）的内容。如果收到警告”以下主机名无效FQDN”，请忽略它并单击”确定”。</p>

<p>&nbsp; &nbsp; &nbsp; &nbsp;d.选择服务：选择以下服务：</p>

<p><img alt="使用Ambari搭建Hadoop集群" class="has" src="http://i2.51cto.com/images/blog/201801/29/7ac6d3d687749ed0aba42cea8827ccf4.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk=">&nbsp;&nbsp;</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">HDFS</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">YARN + MapReduce2</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Tez</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">HBase</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Pig</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Zookeeper</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Storm</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Flume</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Ambari Metrics</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Kafka</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Elasticsearch</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Kibana</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Metron</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Slider</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">OpenTAXII</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Pycapa</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Zeppelin Notebook</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Hive</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; e.分配Masters:在所有节点上分配”Kafka Broker”，确保在一个公共节点上安装以下组件：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs vbscript"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Storm UI <span class="hljs-built_in">Server</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Metron Indexing</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">MySQL <span class="hljs-built_in">Server</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Kibana <span class="hljs-built_in">Server</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Elasticsearch Master</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Metron Parsers</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Metron Enrichment</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; f.&nbsp;分配Slaves和Clients：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">DataNode</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">NodeManager</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">RegionServer</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Supervisor</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Client</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>&nbsp; &nbsp; &nbsp; g.自定义服务：以下是需要配置的服务列表：</p>

<p>(1)在HDFS - &gt; Configs下将”NameNode Java堆大小”（namenode_heapsize）从默认的1024 MB设置为至少4096 MB。</p>

<p>(2)对于ElasticSearch：<br><br>将”zen_discovery_ping_unicast_hosts”设置为在Assign Master选项卡上分配ElasticSearch Master的节点的IP。<br><br>在”Advanced elastic-site”下：将”network_host”更改为”0.0.0.0”。如果Metron暴露在公共互联网上，请不要这样做！现在是“[<em>local</em>，_ site_]”。<br><br>(3)对于Kibana：<br><br>将”kibana_es_url”设置为http:// &lt;elasticsearch_master_hostname&gt;:9200。elasticsearch_master_hostname是”&nbsp;Assign Master&nbsp;”选项卡上分配ElasticSearch Master的节点的IP。<br><br>将”kibana_default_application”更改为”dashboard / Metron-Dashboard”<br><br>(4)对于Metron：将”Elasticsearch Hosts”设置为在Assign Master选项卡上分配ElasticSearch Master的节点的IP。<br><br>(5)对于Storm：将”supervisor.slots.ports”的数量从默认的[6700,6701]增加到[6700,6701,6702,6703,6704]如果只安装一个节点。<br><br>(6)对于metron REST使用：<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC客户端路径：/usr/share/java/mysql-connector-java.jar<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC驱动程序：com.mysql.jdbc.Driver<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC密码：&lt;DB PASSWORD&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC平台：mysql<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC URL：jdbc：mysql：//127.0.0.1：3306 / &lt;DB NAME&gt;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Metron JDBC用户名：&lt;DB USERNAME&gt;</p>

<p>(7)将其余配置值设置为Ambari推荐的或您想要的配置值（如DB密码）并执行安装。在只有3个节点，集群安装如下：</p>

<p><table><thead><tr><th scope="col"><br>            <p>node1</p><br>            </th><br>            <th scope="col"><br>            <p>node2</p><br>            </th><br>            <th scope="col"><br>            <p>node3</p><br>            </th><br>        </tr></thead><tbody><tr><td>DataNode</td><br>            <td>DataNode</td><br>            <td>DataNode</td><br>        </tr><tr><td>Elasticsearch Master</td><br>            <td>App Timeline Server</td><br>            <td><br>            <p>Elasticsearch Data Node</p><br>            </td><br>        </tr><tr><td colspan="1">Grafana</td><br>            <td colspan="1">Kafka Broker</td><br>            <td colspan="1">Metrics Monitor</td><br>        </tr><tr><td colspan="1">HBase Client</td><br>            <td colspan="1">DRPC Server</td><br>            <td colspan="1">Flume</td><br>        </tr><tr><td colspan="1">HBase Master</td><br>            <td colspan="1">HBase Client</td><br>            <td colspan="1">HBase Client</td><br>        </tr><tr><td colspan="1">HCat Client</td><br>            <td colspan="1">HCat Client</td><br>            <td colspan="1">HCat Client</td><br>        </tr><tr><td colspan="1">HDFS Client</td><br>            <td colspan="1">HDFS Client</td><br>            <td colspan="1">HDFS Client</td><br>        </tr><tr><td colspan="1">Hive Client</td><br>            <td colspan="1">Hive Client</td><br>            <td colspan="1">Hive Client</td><br>        </tr><tr><td colspan="1">Kafka Broker</td><br>            <td colspan="1">History Server</td><br>            <td colspan="1">Kafka Broker</td><br>        </tr><tr><td colspan="1">Kibana Server</td><br>            <td colspan="1">Hive Metastore</td><br>            <td colspan="1">MapReduce2 Client</td><br>        </tr><tr><td colspan="1">MapReduce2 Client</td><br>            <td colspan="1">HiveServer2</td><br>            <td colspan="1">Metrics Collector</td><br>        </tr><tr><td colspan="1">Metrics Monitor</td><br>            <td colspan="1">MapReduce2 Client</td><br>            <td colspan="1">Metron Client</td><br>        </tr><tr><td colspan="1">Metron Client</td><br>            <td colspan="1">Metrics Monitor</td><br>            <td colspan="1">NodeManager</td><br>        </tr><tr><td colspan="1">Metron Enrichment</td><br>            <td colspan="1">Metron Client</td><br>            <td colspan="1">Pig Client</td><br>        </tr><tr><td colspan="1">Metron Indexing</td><br>            <td colspan="1">MySQL Server</td><br>            <td colspan="1">Slider Client</td><br>        </tr><tr><td colspan="1">Metron Parsers</td><br>            <td colspan="1">Nimbus</td><br>            <td colspan="1">Spark Client</td><br>        </tr><tr><td colspan="1">Metron REST</td><br>            <td colspan="1">NodeManager</td><br>            <td colspan="1">Supervisor</td><br>        </tr><tr><td colspan="1">NameNode</td><br>            <td colspan="1">Pig Client</td><br>            <td colspan="1">Tez Client</td><br>        </tr><tr><td colspan="1">NodeManager</td><br>            <td colspan="1">ResourceManager</td><br>            <td colspan="1">YARN Client</td><br>        </tr><tr><td colspan="1">Pig Client</td><br>            <td colspan="1">NameNode</td><br>            <td colspan="1">ZooKeeper Client</td><br>        </tr><tr><td colspan="1"><br>            <p>RegionServer</p><br>            </td><br>            <td colspan="1">RegionServer</td><br>            <td colspan="1">RegionServer</td><br>        </tr><tr><td colspan="1">Slider Client</td><br>            <td colspan="1">Slider Client</td><br>            <td colspan="1">ZooKeeper Server</td><br>        </tr><tr><td colspan="1">Spark Client</td><br>            <td colspan="1">Spark Client</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">Spark History Server</td><br>            <td colspan="1">Supervisor</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">Storm UI Server</td><br>            <td colspan="1">Tez Client</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">Supervisor</td><br>            <td colspan="1">WebHCat Server</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">Tez Client</td><br>            <td colspan="1">YARN Client</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">YARN Client</td><br>            <td colspan="1">ZooKeeper Client</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">Zeppelin Notebook</td><br>            <td colspan="1">ZooKeeper Server</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">ZooKeeper Client</td><br>            <td colspan="1">&nbsp;</td><br>            <td colspan="1">&nbsp;</td><br>        </tr><tr><td colspan="1">ZooKeeper Server</td><br>            <td colspan="1">&nbsp;</td><br>            <td colspan="1">&nbsp;</td><br>        </tr></tbody></table></p><p>&nbsp;配置Metron REST，Metron REST可能无法工作，因为我们仍然需要将用户和数据库添加到MariaDB。此时，请确保所有服务都已启动，需要手动启动一些。</p><p></p>
<p>在MySQL中为Metron REST配置用户。在安装Metron REST UI的节点上，执行以下操作：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># mysql -u root -p</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">CREATE USER <span class="hljs-string">'&lt;DB USERNAME&gt;'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED BY <span class="hljs-string">'&lt;DB PASSWORD&gt;'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">CREATE DATABASE <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> EXISTS &lt;DB <span class="hljs-keyword">NAME</span>&gt;;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">GRANT ALL PRIVILEGES <span class="hljs-keyword">ON</span> &lt;DB <span class="hljs-keyword">NAME</span>&gt;.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'&lt;DB USERNAME&gt;'</span>@<span class="hljs-string">'localhost'</span>;</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>例如：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs delphi"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># mysql -u root -p</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; CREATE USER <span class="hljs-string">'metron'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED BY <span class="hljs-string">'metron'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; CREATE DATABASE <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> EXISTS metronrest;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; GRANT ALL PRIVILEGES <span class="hljs-keyword">ON</span> metronrest.* <span class="hljs-keyword">TO</span> <span class="hljs-string">'metron'</span>@<span class="hljs-string">'localhost'</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; quit</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Bye</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"># </div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>在metron REST服务运行之前，我们需要做最后一步。 由于Centos 7中的systemd，服务metron-rest start &lt;PASSWORD&gt;不再有效。因此，必须编辑配置文件”/etc/rc.d/init.d/metron-rest”。 在此文件中，将METRON_JDBC_PASSWORD =”$2”更改为METRON_JDBC_PASSWORD =”&lt;DB PASSWORD&gt;”并通过Ambari界面重新启动metron-rest服务。</p>

<p>配置以下项时，请确保已启动Metron REST UI。</p>

<p>将Metron REST用户名和密码添加到metronrest数据库：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs cs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta"># mysql -u &lt;DB USERNAME&gt; -p</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; use &lt;DB NAME&gt;;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; <span class="hljs-function">insert <span class="hljs-keyword">into</span> <span class="hljs-title">users</span> (<span class="hljs-params">username, password, enabled</span>) <span class="hljs-title">values</span> (<span class="hljs-params"><span class="hljs-string">'&lt;USERNAME&gt;'</span>,<span class="hljs-string">'&lt;PASSWORD&gt;'</span>,<span class="hljs-number">1</span></span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; <span class="hljs-function">insert <span class="hljs-keyword">into</span> <span class="hljs-title">authorities</span> (<span class="hljs-params">username, authority</span>) <span class="hljs-title">values</span> (<span class="hljs-params"><span class="hljs-string">'&lt;USERNAME&gt;'</span>, <span class="hljs-string">'ROLE_USER'</span></span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; quit</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Bye</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>例如：</p>

<pre class="has" name="code" onclick="hljs.copyCode(event)"><code class="hljs cs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta"># mysql -u metron -p</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; use metronrest;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; <span class="hljs-function">insert <span class="hljs-keyword">into</span> <span class="hljs-title">users</span> (<span class="hljs-params">username, password, enabled</span>) <span class="hljs-title">values</span> (<span class="hljs-params"><span class="hljs-string">'metron'</span>,<span class="hljs-string">'metron'</span>,<span class="hljs-number">1</span></span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; <span class="hljs-function">insert <span class="hljs-keyword">into</span> <span class="hljs-title">authorities</span> (<span class="hljs-params">username, authority</span>) <span class="hljs-title">values</span> (<span class="hljs-params"><span class="hljs-string">'metron'</span>, <span class="hljs-string">'ROLE_USER'</span></span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&gt; quit</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">Bye</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#</span></div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre>

<p>确保所有服务都已启动。</p>

<p></p><p>&nbsp;</p>            <br>                <p></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Metron/">Metron</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Metron/">Metron</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://github.com/huashishaojie/2019/05/27/安装Metron/" data-title="安装Metron | Lei&#39;s Blog" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2019/05/27/test/" title="test">
 <strong>下一篇：</strong><br> 
 <span>test
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">2.Metron架构及功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">3.安装Metron</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="huashishaojie" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js"></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Metron/" title="Metron">Metron<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/test/" title="test">test<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/测试/" title="测试">测试<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Metron/" title="Metron">Metron<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://metron.apache.org" target="_blank" title="REAL-TIME BIG DATA SECURITY">Apache Metron</a>
            
          </li>
        
          <li>
            
            	<a href="https://zh.ververica.com/" target="_blank" title="Ververica">Ververica</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Leijie Zhang. <br>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font">
		
		<a href="http://weibo.com/zhangleijie1998" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/huashishaojie" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/zhangleijie1998" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:huashishaojie@gamil.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="zhangleijie">zhangleijie</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
